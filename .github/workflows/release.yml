name: CI

on:
    push:
        branches: ["main"]


permissions: write-all


jobs:
    Deploy:
        runs-on: ubuntu-latest
        steps:
            -   name: Checkout
                uses: actions/checkout@v3
            
            # -   name: Install Appwrite CLI Polyfill
            #     shell: bash
            #     working-directory: ./.polyfill
            #     run: |
            #       chmod +x appwrite.sh
            #       ./appwrite.sh

            -   name: Install Appwrite CLI
                shell: bash
                run: |
                    curl -sL https://appwrite.io/cli/install.sh | bash

            # -   name: Appwrite Version
            #     shell: bash
            #     run: |
            #         appwrite -v
            #         ls

            -   name: Appwrite Deployment
                shell: bash
                working-directory: ./register
                run: |
                    appwrite client \
                    --endpoint='https://cloud.appwrite.io/v1' \
                    --projectId='64fb41b9418dcb632e73' \
                    --key='${{ secrets.APPWRITE_CLOUD }}'

                    appwrite functions createDeployment \
                    --functionId=register \
                    --entrypoint='index.js' \
                    --code='.' \
                    --activate=true